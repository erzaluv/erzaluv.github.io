<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A-Frame Game</title>
   
    <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
    <script src="http://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>
    <a-scene physics="debug: true">
        <!-- Небо -->
        <a-sky color="#87CEEB"></a-sky>

        <!-- Пол -->
        <a-plane position="0 0 0" rotation="-90 0 0" width="100" height="100" color="#7CFC00" static-body></a-plane>

        <!-- Игрок -->
        <a-entity id="player" position="0 1.6 0">
            <a-camera></a-camera>
            <a-entity position="0 0 -1" cursor="rayOrigin: mouse"></a-entity>
        </a-entity>

        <!-- Объекты для сбора -->
        <a-entity id="object1" geometry="primitive: sphere" material="color: red" position="0 1 -5" class="collectable" dynamic-body></a-entity>
        <a-entity id="object2" geometry="primitive: box" material="color: blue" position="3 1 -5" class="collectable" dynamic-body></a-entity>
        <a-entity id="object3" geometry="primitive: cone" material="color: green" position="-3 1 -5" class="collectable" dynamic-body></a-entity>

        <!-- Текстовый элемент для счета -->
        <a-entity id="score" text="value: Score: 0; align: center; width: 4" position="0 2.5 -1.5"></a-entity>

        <!-- Текстовый элемент для таймера -->
        <a-entity id="timer" text="value: Time: 30; align: center; width: 4" position="0 2 -1.5"></a-entity>

        <!-- Анимация исчезновения -->
        <a-entity id="explosion" particle-system="preset: explosion; color: yellow" visible="false"></a-entity>

        <!-- Звук сбора -->
        <a-sound src="https://cdn.aframe.io/360-image-gallery-boilerplate/audio/click.ogg" autoplay="false" id="collectSound"></a-sound>

        <!-- Движущийся объект -->
        <a-entity id="movingObj" geometry="primitive: cone" material="color: red" 
                  position="0 2 -8" animation="property: position; to: 5 2 -8; dur: 2000; loop: true" dynamic-body>
        </a-entity>

        <!-- 3D модель -->
        <a-assets>
            <a-asset-item id="tree" src="https://cdn.aframe.io/test-models/models/tree1/model.gltf"></a-asset-item>
        </a-assets>
        <a-entity gltf-model="#tree" position="5 0 -10" scale="0.5 0.5 0.5"></a-entity>
    </a-scene>

    <script>
        // Инициализация переменных
        let score = 0;
        let timeLeft = 30;

        // Обработка столкновений
        document.querySelectorAll('.collectable').forEach(object => {
            object.addEventListener('collide', function() {
                this.setAttribute('visible', false); // Скрываем объект
                score++; // Увеличиваем счет
                document.querySelector('#score').setAttribute('value', `Score: ${score}`); // Обновляем счет
                document.querySelector('#collectSound').components.sound.playSound(); // Воспроизводим звук
                document.querySelector('#explosion').setAttribute('visible', true); // Анимация исчезновения
                setTimeout(() => document.querySelector('#explosion').setAttribute('visible', false), 500); // Скрываем анимацию
            });
        });

        // Таймер
        const timer = document.querySelector('#timer');
        function updateTimer() {
            timer.setAttribute('value', `Time: ${timeLeft}`);
            if (timeLeft <= 0) {
                endGame();
            } else {
                timeLeft--;
                setTimeout(updateTimer, 1000);
            }
        }

        // Завершение игры
        function endGame() {
            alert(`Game Over! Your score: ${score}`);
            window.location.reload(); // Перезапуск игры
        }

        // Запуск таймера
        updateTimer();

        // Гравитация
        AFRAME.registerComponent('gravity', {
            tick: function () {
                this.el.body.applyForce(0, -9.8, 0);
            }
        });

        // Рандомизация позиций объектов при перезапуске
        function spawnObjects() {
            const positions = [];
            for (let i = 0; i < 5; i++) {
                const x = Math.random() * 10 - 5;
                const z = Math.random() * 10 - 5;
                positions.push({x, y: 1, z});
            }
            return positions;
        }
    </script>
</body>
</html>
